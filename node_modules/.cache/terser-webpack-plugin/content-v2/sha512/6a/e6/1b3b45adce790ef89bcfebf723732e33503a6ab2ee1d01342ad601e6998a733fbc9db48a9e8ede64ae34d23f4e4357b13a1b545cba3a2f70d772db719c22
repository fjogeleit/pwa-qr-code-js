{"code":"!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=1)}([function(e,t){e.exports=function(e){if(\"string\"!=typeof e)return!1;var t=e.match(i);if(!t)return!1;var a=t[1];if(!a)return!1;if(r.test(a)||n.test(a))return!0;return!1};var i=/^(?:\\w+:)?\\/\\/(\\S+)$/,r=/^localhost[\\:?\\d]*(?:[^\\:?\\d]\\S*)?$/,n=/^[^\\s\\.]+\\.\\S{2,}$/},function(e,t,i){\"use strict\";i.r(t);class r{static hasCamera(){return navigator.mediaDevices.enumerateDevices().then(e=>e.some(e=>\"videoinput\"===e.kind)).catch(()=>!1)}constructor(e,t,i=r.DEFAULT_CANVAS_SIZE){this.$video=e,this.$canvas=document.createElement(\"canvas\"),this._onDecode=t,this._paused=this._active=!1,this.$canvas.width=i,this.$canvas.height=i,this._sourceRect={x:0,y:0,width:i,height:i},this._onCanPlay=this._onCanPlay.bind(this),this._onPlay=this._onPlay.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this.$video.addEventListener(\"canplay\",this._onCanPlay),this.$video.addEventListener(\"play\",this._onPlay),document.addEventListener(\"visibilitychange\",this._onVisibilityChange),this._qrWorker=new Worker(r.WORKER_PATH)}destroy(){this.$video.removeEventListener(\"canplay\",this._onCanPlay),this.$video.removeEventListener(\"play\",this._onPlay),document.removeEventListener(\"visibilitychange\",this._onVisibilityChange),this.stop(),this._qrWorker.postMessage({type:\"close\"})}start(){if(this._active&&!this._paused)return Promise.resolve();if(\"https:\"!==window.location.protocol&&console.warn(\"The camera stream is only accessible if the page is transferred via https.\"),this._active=!0,this._paused=!1,document.hidden)return Promise.resolve();if(clearTimeout(this._offTimeout),this._offTimeout=null,this.$video.srcObject)return this.$video.play(),Promise.resolve();let e=\"environment\";return this._getCameraStream(\"environment\",!0).catch(()=>(e=\"user\",this._getCameraStream())).then(t=>{this.$video.srcObject=t,this._setVideoMirror(e)}).catch(e=>{throw this._active=!1,e})}stop(){this.pause(),this._active=!1}pause(){this._paused=!0,this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(()=>{let e=this.$video.srcObject&&this.$video.srcObject.getTracks()[0];e&&(e.stop(),this._offTimeout=this.$video.srcObject=null)},300)))}static scanImage(e,t=null,i=null,n=null,a=!1,s=!1){let o=!1,c=new Promise((s,c)=>{let h,d,l;i||(i=new Worker(r.WORKER_PATH),o=!0,i.postMessage({type:\"inversionMode\",data:\"both\"})),d=e=>{\"qrResult\"===e.data.type&&(i.removeEventListener(\"message\",d),i.removeEventListener(\"error\",l),clearTimeout(h),null!==e.data.data?s(e.data.data):c(\"QR code not found.\"))},l=e=>{i.removeEventListener(\"message\",d),i.removeEventListener(\"error\",l),clearTimeout(h),c(\"Scanner error: \"+(e?e.message||e:\"Unknown Error\"))},i.addEventListener(\"message\",d),i.addEventListener(\"error\",l),h=setTimeout(()=>l(\"timeout\"),3e3),r._loadImage(e).then(e=>{e=r._getImageData(e,t,n,a),i.postMessage({type:\"decode\",data:e},[e.data.buffer])}).catch(l)});return t&&s&&(c=c.catch(()=>r.scanImage(e,null,i,n,a))),c.finally(()=>{o&&i.postMessage({type:\"close\"})})}setGrayscaleWeights(e,t,i,r=!0){this._qrWorker.postMessage({type:\"grayscaleWeights\",data:{red:e,green:t,blue:i,useIntegerApproximation:r}})}setInversionMode(e){this._qrWorker.postMessage({type:\"inversionMode\",data:e})}_onCanPlay(){this._updateSourceRect(),this.$video.play()}_onPlay(){this._updateSourceRect(),this._scanFrame()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_updateSourceRect(){let e=Math.round(2/3*Math.min(this.$video.videoWidth,this.$video.videoHeight));this._sourceRect.width=this._sourceRect.height=e,this._sourceRect.x=(this.$video.videoWidth-e)/2,this._sourceRect.y=(this.$video.videoHeight-e)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{r.scanImage(this.$video,this._sourceRect,this._qrWorker,this.$canvas,!0).then(this._onDecode,e=>{this._active&&\"QR code not found.\"!==e&&console.error(e)}).then(()=>this._scanFrame())})}_getCameraStream(e,t=!1){let i=[{width:{min:1024}},{width:{min:768}},{}];return e&&(t&&(e={exact:e}),i.forEach(t=>t.facingMode=e)),this._getMatchingCameraStream(i)}_getMatchingCameraStream(e){return 0===e.length?Promise.reject(\"Camera not found.\"):navigator.mediaDevices.getUserMedia({video:e.shift()}).catch(()=>this._getMatchingCameraStream(e))}_setVideoMirror(e){this.$video.style.transform=\"scaleX(\"+(\"user\"===e?-1:1)+\")\"}static _getImageData(e,t=null,i=null,r=!1){i=i||document.createElement(\"canvas\");let n=t&&t.x?t.x:0,a=t&&t.y?t.y:0,s=t&&t.width?t.width:e.width||e.videoWidth;return t=t&&t.height?t.height:e.height||e.videoHeight,r||i.width===s&&i.height===t||(i.width=s,i.height=t),(r=i.getContext(\"2d\",{alpha:!1})).imageSmoothingEnabled=!1,r.drawImage(e,n,a,s,t,0,0,i.width,i.height),r.getImageData(0,0,i.width,i.height)}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return r._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof URL||\"string\"==typeof e){let t=new Image;return t.src=e instanceof File?URL.createObjectURL(e):e,r._awaitImageLoad(t).then(()=>(e instanceof File&&URL.revokeObjectURL(t.src),t))}return Promise.reject(\"Unsupported image type.\")}static _awaitImageLoad(e){return new Promise((t,i)=>{if(e.complete&&0!==e.naturalWidth)t();else{let r,n;r=()=>{e.removeEventListener(\"load\",r),e.removeEventListener(\"error\",n),t()},n=()=>{e.removeEventListener(\"load\",r),e.removeEventListener(\"error\",n),i(\"Image load error\")},e.addEventListener(\"load\",r),e.addEventListener(\"error\",n)}})}}r.DEFAULT_CANVAS_SIZE=400,r.WORKER_PATH=\"qr-scanner-worker.min.js\";var n=r,a=i(0),s=i.n(a);\"serviceWorker\"in navigator&&window.addEventListener(\"load\",(function(){navigator.serviceWorker.register(\"/service-worker.js\")})),n.WORKER_PATH=\"./worker/qr-scanner-worker.min.js\";var o=document.querySelector(\"#player\"),c=document.querySelector(\"dialog\"),h=document.querySelector(\"#next-button\"),d=document.querySelector(\"#qr-text\");c.showModal||dialogPolyfill.registerDialog(c),h.addEventListener(\"click\",(function(){c.close(),l.start()}));var l=new n(o,(function(e){s()(e)&&window.open(e,\"_blank\"),d.innerHTML=e,l.stop(),c.showModal()}));l.start()}]);","extractedComments":[]}